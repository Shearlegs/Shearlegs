@page "/management/nodes/{NodeName}/variables"
@using Shearlegs.Web.APIClient.Models.NodeVariables;
@using Shearlegs.Web.Dashboard.Pages.Managements.Nodes.Components

<MudBreadcrumbs Items="BreadcrumbItems" />

<NodeNavigationTabs NodeName="@NodeName" ActivePanelIndex="2" />

<Condition Evaluation="isCanceled">
    <Match>
        <MudAlert Severity="Severity.Info" Variant="Variant.Text" Class="mb-3">
            Node not found!
        </MudAlert>
    </Match>
</Condition>

<LoadingView IsLoaded="isLoaded" IsCanceled="isCanceled">

    <MudTable Items="NodeVariables" Loading="isVariablesLoading" Hover="true" Context="variable" Filter="SearchNodeVariable">
        <ToolBarContent>
            <MudText Typo="Typo.h6">
                Variable List
            </MudText>
            <MudSpacer />
            <MudTextField @bind-Value="searchString"
                          Immediate="true"
                          Placeholder="Search"
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled.Search"
                          IconSize="Size.Medium"
                          Class="mt-0" />
        </ToolBarContent>
        <HeaderContent>
            <MudTh>
                <MudTableSortLabel T="NodeVariable" SortBy="x => x.Name">
                    Name
                </MudTableSortLabel>
            </MudTh>
            <MudTh>
                <MudTableSortLabel T="NodeVariable" SortBy="x => x.Description">
                    Description
                </MudTableSortLabel>
            </MudTh>
            <MudTh>
                <MudTableSortLabel T="NodeVariable" SortBy="x => x.UpdateDate">
                    Update Date
                </MudTableSortLabel>
            </MudTh>
            <MudTh>
                <MudTableSortLabel T="NodeVariable" SortBy="x => x.CreateDate" InitialDirection="SortDirection.Descending">
                    Create Date
                </MudTableSortLabel>
            </MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Name">
                <MudButton OnClick="() => OpenEditDialogAsync(variable)">
                    @variable.Name
                </MudButton>                
            </MudTd>
            <MudTd DataLabel="Description">
                @variable.Description
            </MudTd>
            <MudTd DataLabel="Update Date">
                @(variable.UpdateDate.HasValue ? variable.UpdateDate.Value.LocalDateTime : '-')
            </MudTd>
            <MudTd DataLabel="Create Date">
                @variable.CreateDate.LocalDateTime
            </MudTd>
        </RowTemplate>
    </MudTable>

    <div style="position: fixed; right: 16px; bottom: 16px;">
        <MudFab Color="Color.Primary"
            StartIcon="@Icons.Material.Filled.Add"
            Size="Size.Large"
            Label="Add Variable"
            OnClick="OpenAddDialogAsync"
            />
    </div>
</LoadingView>
